# Radiative equilibrium.planar problem for testing the coupling of the radiation solver with the
# energy equation. This serves as verification for the radiation solver.
---
environment:
  title: _equilibrium.spherical
  tagDirectory: true
arguments:
  dm_plex_gmsh_use_regions: true
timestepper:
  # setup default controls for the time stepper
  arguments:
    ts_type: rk
    ts_max_time: 1.0E10
    ts_max_steps: 10000000
    ts_dt: 1.0E-9
    # petsc adaptive timestepping can be turned on to replace physics timestepping
    ts_adapt_safety: 0.99
  # io controls how often the results are saved to a file for visualization and restart
  io:
    #  results are outputted every 0.001 seconds of real simulation time
    interval: 0
  # load in a mesh file
  domain: !ablate::domain::MeshFile
    name: volumeMesh
    path: /home/owen/post-processing/ablate/test_thing.msh
    # Options to be applied to the volumetric geometry
    options:
      dm_plex_check_all: true
      dm_plex_hash_location: true
      dm_distribute_overlap: 1
    modifiers:
      # if using mpi, this modifier distributes cells
      - !ablate::domain::modifiers::DistributeWithGhostCells
        ghostCellDepth: 1
      # Create a region for the flat plate heat flux monitor to operate on
      - !ablate::domain::modifiers::CreateLabel
        region:
          name: outerSphere
        function: !ablate::mathFunctions::geom::Sphere
          center: [ 0, 0, 0 ]
          radius: 10
      # Create a region for the flat plate heat flux monitor to operate on
      - !ablate::domain::modifiers::CreateLabel
        region:
          name: innerSphere
        function: !ablate::mathFunctions::geom::Sphere
          center: [ 0, 0, 0 ]
          radius: 5
      - !ablate::domain::modifiers::CreateLabel
        region:
          name: R1_bound
        function: !ablate::mathFunctions::geom::Sphere
          center: [ 0, 0, 0 ]
          radius: 4
      - !ablate::domain::modifiers::CreateLabel
        region:
          name: R2_bound
        function: !ablate::mathFunctions::geom::Sphere
          center: [ 0, 0, 0 ]
          radius: 11
      - !ablate::domain::modifiers::SubtractLabel
        # separates the regions above and below the slab
        differenceRegion:
          name: R2
        minuendRegion:
          name: R2_bound
        subtrahendRegions:
          - name: outerSphere
      - !ablate::domain::modifiers::SubtractLabel
        # separates the regions above and below the slab
        differenceRegion:
          name: R1
        minuendRegion:
          name: innerSphere
        subtrahendRegions:
          - name: R1_bound
      - !ablate::domain::modifiers::SubtractLabel
        # separates the regions above and below the slab
        differenceRegion:
          name: shellRegion
        minuendRegion:
          name: outerSphere
        subtrahendRegions:
          - name: innerSphere
      - !ablate::domain::modifiers::MergeLabels
        mergedRegion:
          name: volume
        regions:
          - name: R2
          - name: R1
          - name: shellRegion
    fields:
      - !ablate::finiteVolume::CompressibleFlowFields
        eos: !ablate::eos::PerfectGas &eos
          parameters:
            gamma: 1.4
            Rgas: 287.0
        conservedFieldOptions:
          petscfv_type: leastsquares
          petsclimiter_type: vanleer
  initialization:
    - !ablate::finiteVolume::fieldFunctions::Euler
      region:
        name: volume
      state: &initFlowState
        eos: *eos
        pressure: 1.0
        temperature: !ablate::mathFunctions::Formula
          formula: "sqrt((x*x)+(y*y)+(z*z))*200.0"
        velocity: "0.0, 0.0, 0.0"
    - !ablate::finiteVolume::fieldFunctions::Euler
      region:
        name: R1
      state: &R1State
        eos: *eos
        temperature: 1000
        pressure: 1.0
        velocity: "0.0, 0.0, 0.0"
    - !ablate::finiteVolume::fieldFunctions::Euler
      region:
        name: R2
      state: &R2State
        eos: *eos
        temperature: 2000
        pressure: 1.0
        velocity: "0.0, 0.0, 0.0"
solvers:
  - !ablate::finiteVolume::CompressibleFlowSolver
    id: vortexFlowField
    region:
      name: volume
    monitors:
      - !ablate::monitors::TimeStepMonitor
        interval: 0
    eos: *eos
  - !ablate::radiation::VolumeRadiation
    id: radiationSolver
    region:
      name: shellRegion
    interval: 0
    radiation: !ablate::radiation::RaySharingRadiation
      id: flameradiation
      region:
        name: shellRegion
      rays: 23
      properties: !ablate::eos::radiationProperties::Constant
        absorptivity: 1
        emissivity: 1
        eos: *eos
      log: !ablate::monitors::logs::StdOut
        name: radlog